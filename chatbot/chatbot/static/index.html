<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Zabbix Chat</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    #log { border: 1px solid #ddd; padding: 1rem; height: 60vh; overflow:auto; }
    .me { color: #222; }
    .bot { color: #0a7; }
    .meta { color: #666; font-size: 0.9em; }
    input, button { padding: .6rem .8rem; font-size: 1rem; }
  </style>
</head>
<body>
  <h1>üõ†Ô∏è Zabbix Chat (Ollama ‚Üí MCP)</h1>
  <div id="log"></div>
  <div style="margin-top:1rem;">
    <input id="msg" placeholder="Ask: 'Show the 5 most recent problems'" style="width:70%;" />
    <button id="send">Send</button>
  </div>
  <script>
    const log = document.getElementById('log');
    const msg = document.getElementById('msg');
    const send = document.getElementById('send');

    function addLine(cls, text) {
      const div = document.createElement('div');
      div.className = cls;
      div.textContent = text;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    async function ask() {
      const q = msg.value.trim();
      if (!q) return;
      addLine('me', 'You: ' + q);
      msg.value = '';
      try {
        const resp = await fetch('/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: q })
        });
        const data = await resp.json();
        if (data.error) {
          addLine('bot', 'Error: ' + data.error);
          return;
        }
        addLine('meta', 'Tool: ' + JSON.stringify(data.choice));
        addLine('bot', 'Result: ' + JSON.stringify(data.result));
      } catch (e) {
        addLine('bot', 'Network error: ' + e);
      }
    }

    send.onclick = ask;
    msg.onkeydown = (e) => { if (e.key === 'Enter') ask(); };
  </script>
</body>
</html>

